function LatLon(e,t,n){if(typeof n==="undefined"){n=6371}this._lat=e;this._lon=t;this._radius=n;this.toString=function(){return this._lat+", "+this._lon}}var Geo={};LatLon.prototype.distanceTo=function(e,t){if(typeof t==="undefined"){t=4}var n=this._radius;var r=this._lat.toRad(),i=this._lon.toRad();var s=e._lat.toRad(),o=e._lon.toRad();var u=s-r;var a=o-i;var f=Math.sin(u/2)*Math.sin(u/2)+Math.cos(r)*Math.cos(s)*Math.sin(a/2)*Math.sin(a/2);var l=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f));var c=n*l;return c.toPrecisionFixed(t)};LatLon.prototype.bearingTo=function(e){var t=this._lat.toRad(),n=e._lat.toRad();var r=(e._lon-this._lon).toRad();var i=Math.sin(r)*Math.cos(n);var s=Math.cos(t)*Math.sin(n)-Math.sin(t)*Math.cos(n)*Math.cos(r);var o=Math.atan2(i,s);return(o.toDeg()+360)%360};LatLon.prototype.finalBearingTo=function(e){var t=e._lat.toRad(),n=this._lat.toRad();var r=(this._lon-e._lon).toRad();var i=Math.sin(r)*Math.cos(n);var s=Math.cos(t)*Math.sin(n)-Math.sin(t)*Math.cos(n)*Math.cos(r);var o=Math.atan2(i,s);return(o.toDeg()+180)%360};LatLon.prototype.midpointTo=function(e){var t=this._lat.toRad(),n=this._lon.toRad(),r=e._lat.toRad(),i=(e._lon-this._lon).toRad(),s=Math.cos(r)*Math.cos(i),o=Math.cos(r)*Math.sin(i),u=Math.atan2(Math.sin(t)+Math.sin(r),Math.sqrt((Math.cos(t)+s)*(Math.cos(t)+s)+o*o)),a=n+Math.atan2(o,Math.cos(t)+s);return new LatLon(u.toDeg(),a.toDeg())};LatLon.prototype.destinationPoint=function(e,t){t=t/this._radius;e=e.toRad();var n=this._lat.toRad(),r=this._lon.toRad(),i=Math.asin(Math.sin(n)*Math.cos(t)+Math.cos(n)*Math.sin(t)*Math.cos(e)),s=r+Math.atan2(Math.sin(e)*Math.sin(t)*Math.cos(n),Math.cos(t)-Math.sin(n)*Math.sin(i));s=(s+3*Math.PI)%(2*Math.PI)-Math.PI;if(isNaN(i)||isNaN(s)){return null}return new LatLon(i.toDeg(),s.toDeg())};LatLon.intersection=function(e,t,n,r){var i=e._lat.toRad(),s=e._lon.toRad(),o=n._lat.toRad(),u=n._lon.toRad(),a,f,l=t.toRad(),c=r.toRad(),h=o-i,p=u-s,d=2*Math.asin(Math.sqrt(Math.sin(h/2)*Math.sin(h/2)+Math.cos(i)*Math.cos(o)*Math.sin(p/2)*Math.sin(p/2)));if(d===0){return null}var v=Math.acos((Math.sin(o)-Math.sin(i)*Math.cos(d))/(Math.sin(d)*Math.cos(i)));if(isNaN(v)){v=0}var m=Math.acos((Math.sin(i)-Math.sin(o)*Math.cos(d))/(Math.sin(d)*Math.cos(o)));if(Math.sin(u-s)>0){a=v;f=2*Math.PI-m}else{a=2*Math.PI-v;f=m}var g=(l-a+Math.PI)%(2*Math.PI)-Math.PI;var y=(f-c+Math.PI)%(2*Math.PI)-Math.PI;if(Math.sin(g)===0&&Math.sin(y)===0||Math.sin(g)*Math.sin(y)<0){return null}var b=Math.acos(-Math.cos(g)*Math.cos(y)+Math.sin(g)*Math.sin(y)*Math.cos(d)),w=Math.atan2(Math.sin(d)*Math.sin(g)*Math.sin(y),Math.cos(y)+Math.cos(g)*Math.cos(b)),E=Math.asin(Math.sin(i)*Math.cos(w)+Math.cos(i)*Math.sin(w)*Math.cos(l)),S=Math.atan2(Math.sin(l)*Math.sin(w)*Math.cos(i),Math.cos(w)-Math.sin(i)*Math.sin(E)),x=(s+S+Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(E.toDeg(),x.toDeg())};LatLon.prototype.rhumbDistanceTo=function(e){var t=this._radius,n=this._lat.toRad(),r=e._lat.toRad(),i=(e._lat-this._lat).toRad(),s=Math.abs(e._lon-this._lon).toRad(),o=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),u=!isNaN(i/o)?i/o:Math.cos(n);if(s>Math.PI){s=2*Math.PI-s}var a=Math.sqrt(i*i+u*u*s*s)*t;return a.toPrecisionFixed(4)};LatLon.prototype.rhumbBearingTo=function(e){var t=this._lat.toRad(),n=e._lat.toRad(),r=(e._lon-this._lon).toRad(),i=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(t/2+Math.PI/4));if(Math.abs(r)>Math.PI){r=r>0?-(2*Math.PI-r):2*Math.PI+r}var s=Math.atan2(r,i);return(s.toDeg()+360)%360};LatLon.prototype.rhumbDestinationPoint=function(e,t){var n=this._radius,r=parseFloat(t)/n,i=this._lat.toRad(),s=this._lon.toRad();e=e.toRad();var o=i+r*Math.cos(e),u=o-i,a=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),f=!isNaN(u/a)?u/a:Math.cos(i),l=r*Math.sin(e)/f;if(Math.abs(o)>Math.PI/2){o=o>0?Math.PI-o:-(Math.PI-o)}var c=(s+l+3*Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(o.toDeg(),c.toDeg())};LatLon.prototype.lat=function(e,t){return typeof e==="undefined"?this._lat:Geo.toLat(this._lat,e,t)};LatLon.prototype.lon=function(e,t){return typeof e==="undefined"?this._lon:Geo.toLon(this._lon,e,t)};LatLon.prototype.toString=function(e,t){if(typeof e==="undefined"){e="dms"}return Geo.toLat(this._lat,e,t)+", "+Geo.toLon(this._lon,e,t)};if(typeof String.prototype.toRad==="undefined"){Number.prototype.toRad=function(){return this*Math.PI/180}}if(typeof String.prototype.toDeg==="undefined"){Number.prototype.toDeg=function(){return this*180/Math.PI}}if(typeof String.prototype.toDeg==="undefined"){Number.prototype.toPrecisionFixed=function(e){var t=this<0?-this:this,n=this<0?"-":"",r,i;if(t===0){r="0.";while(e--){r+="0"}return r}var s=Math.ceil(Math.log(t)*Math.LOG10E);r=String(Math.round(t*Math.pow(10,e-s)));if(s>0){i=s-r.length;while(i-->0){r=r+"0"}if(s<r.length){r=r.slice(0,s)+"."+r.slice(s)}}else{while(s++<0){r="0"+r}r="0."+r}return n+r}}Geo.parseDMS=function(e){var t;if(typeof e==="number"&&isFinite(e)){return Number(e)}var n=String(e).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(n[n.length-1]===""){n.splice(n.length-1)}if(n===""){return NaN}switch(n.length){case 3:t=n[0]+n[1]/60+n[2]/3600;break;case 2:t=n[0]+n[1]/60;break;case 1:t=n[0];break;default:return NaN}if(/^-|[WS]$/i.test(e.trim())){t=-t}return Number(t)};Geo.toDMS=function(e,t,n){if(typeof e==="object"){throw new TypeError("Geo.toDMS - deg is [DOM?] object")}if(isNaN(e)){return null}if(typeof t==="undefined"){t="dms"}if(typeof n==="undefined"){switch(t){case"d":n=4;break;case"dm":n=2;break;case"dms":n=0;break;default:t="dms";n=0}}e=Math.abs(e);var r,i,s,o;switch(t){case"d":i=e.toFixed(n);if(i<100){i="0"+i}if(i<10){i="0"+i}r=i+"°";break;case"dm":var u=(e*60).toFixed(n);i=Math.floor(u/60);s=(u%60).toFixed(n);if(i<100){i="0"+i}if(i<10){i="0"+i}if(s<10){s="0"+s}r=i+"°"+s+"′";break;case"dms":var a=(e*3600).toFixed(n);i=Math.floor(a/3600);s=Math.floor(a/60)%60;o=(a%60).toFixed(n);if(i<100){i="0"+i}if(i<10){i="0"+i}if(s<10){s="0"+s}if(o<10){o="0"+o}r=i+"°"+s+"′"+o+"″";break}return r};Geo.toLat=function(e,t,n){var r=Geo.toDMS(e,t,n);return r===null?"–":r.slice(1)+(e<0?"S":"N")};Geo.toLon=function(e,t,n){var r=Geo.toDMS(e,t,n);return r===null?"–":r+(e<0?"W":"E")};Geo.toBearing=function(e,t,n){e=(Number(e)+360)%360;var r=Geo.toDMS(e,t,n);return r==null?"–":r.replace("360","0")};if(!window.console){window.console={log:function(){}}}